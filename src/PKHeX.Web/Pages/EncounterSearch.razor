@page "/pokemon/search-encounter"
@using PKHeX.Facade.Repositories
@inject EncounterService EncounterService

<Space Direction="DirectionVHType.Vertical" Style="width: 100%; gap: 20px;">
    <GameVersionSelect 
        Source="GameVersionSelect.DataSource.CurrentGame"
        SelectedGameVersion="EncounterService.SelectedGameVersion"
        SelectedGameVersionChanged="HandleGameVersionChanged"/>
    
    <SpeciesSelect
        Source="SpeciesSelect.DataSource.CurrentGame"
        SelectedSpecies="EncounterService.SelectedSpecies"
        SelectedSpeciesChanged="HandleSelectedSpeciesChanged"/>

    <PokemonEncounterTable
        DataSource="EncounterService.Encounters"/>
</Space>

@code {

    private void HandleSelectedSpeciesChanged(SpeciesDefinition? definition)
    {
        if (definition is null) return;
        
        EncounterService.SelectedSpecies = definition;
        TryToSearch();
    }
    
    private void HandleGameVersionChanged(GameVersionDefinition? definition)
    {
        if (definition is null) return;
        
        EncounterService.SelectedGameVersion = definition;
        TryToSearch();
    }

    private void TryToSearch()
    {
        if (!EncounterService.AllowedToSearch) return;
        EncounterService.Search();
    }

}